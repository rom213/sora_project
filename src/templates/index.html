{% extends 'layout.html' %}

{% block titles %} Chat App {% endblock %}

{% block body %}
<div class="">
    <div class="w-full h-16 bg-yellow-200 fixed z-20">
        <h2 class="sm:text-3xl">Bienvenido {{ current_user.fullname }}</h2>
        <div id="logoutBtn">
            <a href="{{ url_for('users.logout') }}">Logout</a>
        </div>
    </div>

    <div class="bg-[#A5D2FF] w-full h-full absolute  overflow-x-auto p-6 pt-20 pb-8">
        {% include 'chatgroup/chatGroup.html' %}
    </div>
</div>





    <script>
        const { createApp, ref, onMounted } = Vue;

        createApp({
            setup() {
                const socket = ref(null);
                const messages = ref(JSON.parse('{{ messages|tojson|safe }}')); 
                let emojis = ref([
                '😀', '😄', '😁', '😂', '🤣', '😊', '😍', '🥰', '🤭', '🤷',
                '🙋‍♀️', '🙋', '🙈', '🙉', '🙊', '🐨', '🐯', '🌿', '☘', '🍀',
                '⚡', '🔥', '💥', '⛈', '🌞', '🎄', '💏', '😡', '😔', '🍉',
                '🍊', '🏉', '🏊‍♂️', '🏄‍♀️', '🎯', '🪑', '👩‍🦯', '🎉', '🎂', '🎃',
                '🕯', '🎁', '🎈', '🍪', '🍩', '🍻', '🥂', '🥳', '🤖', '👾',
                '🤡', '👻', '👽', '💀', '🎃', '🎨', '🎤', '🎧', '🎷', '🎸',
                '🎺', '🎻', '🥁', '🎮', '🖥', '💻', '📱', '📷', '📺', '⏰',
                '🛏', '🚪', '🗝', '🛋', '🚽', '🚿', '🛁', '🛒', '🚲', '🚕',
                '🚌', '🚎', '🚓', '🚑', '🚒', '🚜', '🚛', '🚍', '🚂', '🚀',
                '🎢', '🎡', '🎠', '🎪', '🎬', '🎭', '🖼', '🎳', '🎽', '🏅',
                '🏆', '🥇', '🥈', '🥉', '⚽', '🏀', '🏈', '🎾', '🏐', '🏓',
                '🏸', '🏒', '🏑', '🥅', '⛳', '🎣', '🤿', '🎽', '🏹', '🧑‍🎤',
                '🧑‍🍳', '🧑‍🔬', '🧑‍🚀', '👶', '👨‍🍼', '🧓', '🦸‍♂️', '🦸‍♀️', '🦹‍♂️', '🦹‍♀️',
                '🧙‍♂️', '🧙‍♀️', '🧚‍♂️', '🧚‍♀️', '🧞‍♂️', '🧞‍♀️', '🧜‍♂️', '🧜‍♀️', '🧛‍♂️', '🧛‍♀️',
                '🧟‍♂️', '🧟‍♀️', '🧞'
            ]);
                 // Cargar mensajes desde el servidor
                const message = ref('');

                const modalEmojis=ref(false);

                const toogleEmojis=()=>{
                    modalEmojis.value=!modalEmojis.value
                }

                const adEmoji=(value)=>{
                    message.value=message.value.concat(value)
                }
                
                const sendMessage = () => {
                    if (message.value) {
                        socket.value.emit('message', message.value);
                        message.value = '';
                    }
                };

                onMounted(() => {
                    socket.value = io.connect();
                    socket.value.on('message', (data) => {
                        messages.value.push(data[data.length-1]);
                    });
                });

                return {
                    messages,
                    message,
                    sendMessage,
                    emojis,
                    toogleEmojis,
                    modalEmojis,
                    adEmoji
                };
            }
        }).mount('#app');
    </script>
{% endblock %}

