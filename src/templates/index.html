{% extends 'layout.html' %}

{% block titles %} Chat App {% endblock %}

{% block body %}
<div id="app" class="">

    <div>
        {% include 'header/header.html' %}
    </div>


    <div v-if="navi === 'group'" class="bg-[#A5D2FF] w-full h-screen absolute pt-[70px]">
        <div class="bg-red-100 overflow-x-auto px-1 sm:px-8 h-full relative pb-2 rounded-lg z-40 pt-2">
            {% include 'chatgroup/chatGroup.html' %}
        </div>
    </div>


    <div v-if="navi === 'psi'" class="bg-[#A5D2FF] w-full h-screen pt-[70px] ">
        <div class="bg-red-100 px-1 sm:px-8 h-full pb-2 rounded-lg  pt-2 relative  z-50">
            {% include 'psico/psico.html' %}
        </div>
    </div>


</div>





<script>
    const { createApp, ref, onMounted } = Vue;

    createApp({
        setup() {
            const socket = ref(null);
            const messages = ref(JSON.parse('{{ messages|tojson|safe }}'));
            const psych = ref(JSON.parse('{{ psychology|tojson|safe }}'));
            const userLogin = ref(JSON.parse('{{ userLogin|tojson|safe }}'));



            const sidebarPsych = ref(false)

            const psychologyMessage = ref(null)
            const message = ref('');
            const navi = ref('psi');

            let indexMessagePys = null



            let emojis = ref([
                'üòÄ', 'üòÑ', 'üòÅ', 'üòÇ', 'ü§£', 'üòä', 'üòç', 'ü•∞',
                'üòî', 'üò°', 'üòà', 'ü•µ', 'ü§§', 'ü§©', 'üò¢', 'üòú',
                'üòÖ', 'üòÜ', 'üòá', 'üôÉ', 'üòè', 'üòû', 'üòï', 'üòü',
                'üò§', 'üò©', 'üò≠', 'üò±', 'üò≥', 'üòú', 'ü§Ø', 'üòé',
                'ü§≠', 'ü§∑', 'üôã‚Äç‚ôÄÔ∏è', 'üôã', 'üôà', 'üôâ', 'üôä', 'üñï',
                'üëç', 'üëé', 'üëè', 'üëå', '‚úåÔ∏è', 'ü§ô', 'üôè', 'ü§ü',
                'üíè', 'üíñ', 'üíò', 'üíù', 'üíî', 'üíï', 'üíû', 'üíì',
                'üíó', 'üíô', 'üíö', 'üíõ', 'üñ§', 'üíú', 'ü§ç', 'üíü',
                '‚ö°', 'üî•', 'üí•', 'üåû', 'üåø', '‚òò', 'üçÄ', 'üåª',
                'üåà', '‚ùÑÔ∏è', 'üí®', 'üåä', 'üåß', 'üå™', '‚õà', 'üåã',
                'üíª', 'üì±', 'üñ•', 'üì∑', 'üì∫', '‚åö', '‚è∞', 'üí°',
                'üîã', 'üîå', 'üìû', 'üîë', 'üõè', 'üö™', 'üöø', 'üõÅ',
                '‚öΩ', 'üèÄ', 'üèà', 'üéæ', 'üèÜ', 'ü•á', 'ü•à', 'ü•â',
                'üéÆ', 'üé≥', 'üèì', 'üè∏', 'üèí', 'üéØ', 'ü§ø', 'üèπ',
                'üçâ', 'üçä', 'üç™', 'üç©', 'üçª', 'ü•Ç', 'üçî', 'üçï',
                'üçñ', 'üçó', 'üç§', 'üç£', 'üçö', 'üçú', 'üç´', 'üçø',
                'üëæ', 'üëª', 'ü§ñ', 'üíÄ', 'üéÉ', 'üßõ‚Äç‚ôÇÔ∏è', 'üßü‚Äç‚ôÇÔ∏è', 'üßû‚Äç‚ôÇÔ∏è',
                'üßô‚Äç‚ôÇÔ∏è', 'ü¶∏‚Äç‚ôÄÔ∏è', 'ü¶π‚Äç‚ôÇÔ∏è', 'üßú‚Äç‚ôÄÔ∏è', 'üßö‚Äç‚ôÄÔ∏è', 'üëΩ', 'ü§°', 'üé©',
                'üöï', 'üöÄ', 'üöå', 'üöé', 'üöì', 'üöë', 'üöí', 'üöú',
                'üöÇ', 'üöÉ', 'üöÅ', 'üõ≥', 'üö¢', 'üö§', '‚õµ', 'üö≤',
                'üé§', 'üé∏', 'üé∫', 'üéª', 'ü•Å', 'üé∑', 'üéß', 'üéº',
            ]);


            toogleSidebarPsi = () => {
                sidebarPsych.value = !sidebarPsych.value
            }


            toogleNaviChatPsyc = (index, id) => {
                console.log(id);
                sidebarPsych.value = false
                indexMessagePys = id
                psychologyMessage.value = psych.value[index];
            }


            const modalEmojis = ref(false);

            const toogleEmojis = () => {
                modalEmojis.value = !modalEmojis.value
            }

            const toogleNvigate = (val) => {
                navi.value = val
            }



            const adEmoji = (value) => {
                message.value = message.value.concat(value)
            }



            const sendMessage = (user) => {
                if (message.value && navi.value === 'group') {
                    socket.value.emit('message', message.value);
                    message.value = '';
                }

                if (message.value && navi.value === 'psi') {

                    data = { message: message.value, conexion_id: user.conexion_id, user_id: user.id, rol: user.rol }
                    socket.value.emit('message_psi', data)
                    message.value = '';
                }
            };



            onMounted(() => {
                socket.value = io.connect();
                socket.value.on('message', (data) => {
                    messages.value.push(data[data.length - 1]);
                });

                socket.value.on('message_psi', (data) => {
                    if (data[0].userLoginId === userLogin.value.id) {
                        if (indexMessagePys !== null) {
                            psychologyMessage.value = data.find(item => item.id === indexMessagePys);
                        }
                        psych.value = data
                    }



                });
            });

            return {
                userLogin,

                messages,
                message,
                sendMessage,



                emojis,
                toogleEmojis,
                modalEmojis,
                adEmoji,


                navi,
                toogleNvigate,

                psych,

                psychologyMessage,
                toogleNaviChatPsyc,

                sidebarPsych,
                toogleSidebarPsi
            };
        }
    }).mount('#app');
</script>

<style>
    .scrollbar-custom::-webkit-scrollbar {
        width: 8px;
        /* Ancho del scrollbar */
        height: 8px;
        /* Altura del scrollbar (para el desplazamiento horizontal) */
    }

    .scrollbar-custom::-webkit-scrollbar-thumb {
        background-color: #888;
        /* Color del "pulgar" */
        border-radius: 10px;
        /* Bordes redondeados */
    }

    .scrollbar-custom::-webkit-scrollbar-thumb:hover {
        background-color: #555;
        /* Color del "pulgar" al pasar el rat√≥n por encima */
    }
</style>
{% endblock %}