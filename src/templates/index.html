{% extends 'layout.html' %}

{% block titles %} Chat App {% endblock %}

{% block body %}
<div id="app" class="">

    <div>
        {% include 'header/header.html' %}
    </div>
    

    <div v-if="navi === 'group'" class="bg-[#A5D2FF] w-full h-screen absolute pt-[70px]">
        <div class="bg-red-100 overflow-x-auto px-8 h-full relative pb-2 rounded-lg z-40 pt-2">
            {% include 'chatgroup/chatGroup.html' %}
        </div>
    </div>


    <div v-if="navi === 'psi'" class="bg-[#A5D2FF] w-full h-screen pt-[80px]">
        <div class="bg-red-100  px-8 h-full pb-2 rounded-lg z-40 pt-2">
            {% include 'psico/psico.html' %}
        </div>
    </div>
    
    
</div>





    <script>
        const { createApp, ref, onMounted } = Vue;

        createApp({
            setup() {
                const socket = ref(null);
                const messages = ref(JSON.parse('{{ messages|tojson|safe }}')); 
                const psych=ref(JSON.parse('{{ psychology|tojson|safe }}'))


                const psychologyMessage=ref(null)
                const message = ref('');
                const navi = ref('psi');

                console.log(psych)

                let indexMessagePys=null



                let emojis = ref([
                '😀', '😄', '😁', '😂', '🤣', '😊', '😍', '🥰', '🤭', '🤷',
                '🙋‍♀️', '🙋', '🙈', '🙉', '🙊', '🫦', '🐯', '🌿', '☘', '🍀',
                '⚡', '🔥', '💥', '⛈', '🌞', '🎄', '💏', '😡', '😔', '🍉',
                '🍊', '🏉', '🏊‍♂️', '🏄‍♀️', '🎯', '🪑', '👩‍🦯', '🎉', '🎂', '🎃',
                '🕯', '🎁', '🎈', '🍪', '🍩', '🍻', '🥂', '🥳', '🤖', '👾',
                '🤡', '👻', '👽', '💀', '🎃', '🎨', '🎤', '🎧', '🎷', '🎸',
                '🎺', '🎻', '🥁', '🎮', '🖥', '💻', '📱', '📷', '📺', '⏰',
                '🛏', '🚪', '🗝', '🛋', '🚽', '🚿', '🛁', '🛒', '🚲', '🚕',
                '🚌', '🚎', '🚓', '🚑', '🚒', '🚜', '🚛', '🚍', '🚂', '🚀',
                '🎢', '🎡', '🎠', '🎪', '🎬', '🎭', '🖼', '🎳', '🎽', '🏅',
                '🏆', '🥇', '🥈', '🥉', '⚽', '🏀', '🏈', '🎾', '🏐', '🏓',
                '🏸', '🏒', '🏑', '🥅', '⛳', '🎣', '🤿', '🎽', '🏹', '🧑‍🎤',
                '🧑‍🍳', '🧑‍🔬', '🧑‍🚀', '👶', '👨‍🍼', '🧓', '🦸‍♂️', '🦸‍♀️', '🦹‍♂️', '🦹‍♀️',
                '🧙‍♂️', '🧙‍♀️', '🧚‍♂️', '🧚‍♀️', '🧞‍♂️', '🧞‍♀️', '🧜‍♂️', '🧜‍♀️', '🧛‍♂️', '🧛‍♀️',
                '🧟‍♂️', '🧟‍♀️','🖕','🥵','🤤','😈'
            ]);


                toogleNaviChatPsyc=(index)=>{
                    indexMessagePys=index
                    psychologyMessage.value=psych.value[index];
                }


                const modalEmojis=ref(false);

                const toogleEmojis=()=>{
                    modalEmojis.value=!modalEmojis.value
                }

                const toogleNvigate=(val)=>{
                    navi.value=val
                }



                const adEmoji=(value)=>{
                    message.value=message.value.concat(value)
                }


                
                const sendMessage = (user) => {
                    if (message.value && navi.value==='group') {
                        socket.value.emit('message', message.value);
                        message.value = '';
                    }

                    if (message.value && navi.value==='psi') {
                        data={message:message.value, conexion_id:user.conexion_id, user_id:user.id}
                        socket.value.emit('message_psi', data)
                        message.value = '';
                    }
                };



                onMounted(() => {
                    socket.value = io.connect();
                    socket.value.on('message', (data) => {
                        messages.value.push(data[data.length-1]);
                    });

                    socket.value.on('message_psi', (data) => {
                        if (indexMessagePys !== null) {
                            psychologyMessage.value=data[indexMessagePys]
                        }
                        psych.value=data
                    });
                });

                return {
                    messages,
                    message,
                    sendMessage,
                    emojis,
                    toogleEmojis,
                    modalEmojis,
                    adEmoji,
                    navi,
                    toogleNvigate,
                    psych,
                    psychologyMessage,
                    toogleNaviChatPsyc
                };
            }
        }).mount('#app');
    </script>
{% endblock %}

